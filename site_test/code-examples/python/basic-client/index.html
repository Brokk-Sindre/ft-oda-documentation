<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Python Basic Client - Test</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../../css/brands.min.css" rel="stylesheet">
        <link href="../../../css/solid.min.css" rel="stylesheet">
        <link href="../../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">Test</a>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#python-basic-client" class="nav-link">Python Basic Client</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#complete-client-implementation" class="nav-link">Complete Client Implementation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#key-features" class="nav-link">Key Features</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#installation-setup" class="nav-link">Installation &amp; Setup</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="python-basic-client">Python Basic Client</h1>
<p>A complete, production-ready Python client for the Danish Parliament API with comprehensive error handling.</p>
<h2 id="complete-client-implementation">Complete Client Implementation</h2>
<pre><code class="language-python">import requests
import urllib.parse
import time
from typing import Dict, List, Optional, Union, Any
from datetime import datetime, timedelta
import json

class DanishParliamentAPI:
    &quot;&quot;&quot;
    Production-ready client for Danish Parliament Open Data API (oda.ft.dk)

    Features:
    - Comprehensive error handling
    - Automatic retry with exponential backoff
    - Built-in pagination support
    - Rate limiting protection
    - Complete type hints
    &quot;&quot;&quot;

    def __init__(self, timeout: int = 30, retry_attempts: int = 3):
        &quot;&quot;&quot;
        Initialize the API client.

        Args:
            timeout: Request timeout in seconds
            retry_attempts: Number of retry attempts for failed requests
        &quot;&quot;&quot;
        self.base_url = &quot;https://oda.ft.dk/api/&quot;
        self.timeout = timeout
        self.retry_attempts = retry_attempts
        self.last_request_time = 0
        self.min_request_interval = 0.1  # Minimum 100ms between requests

    def _rate_limit(self) -&gt; None:
        &quot;&quot;&quot;Enforce rate limiting between requests.&quot;&quot;&quot;
        elapsed = time.time() - self.last_request_time
        if elapsed &lt; self.min_request_interval:
            time.sleep(self.min_request_interval - elapsed)
        self.last_request_time = time.time()

    def _make_request(self, url: str) -&gt; Dict[str, Any]:
        &quot;&quot;&quot;
        Make HTTP request with retry logic and error handling.

        Args:
            url: Complete URL to request

        Returns:
            Parsed JSON response

        Raises:
            APIError: For various API errors
            NetworkError: For network-related errors
        &quot;&quot;&quot;
        self._rate_limit()

        for attempt in range(self.retry_attempts):
            try:
                response = requests.get(url, timeout=self.timeout)

                # Handle different HTTP status codes
                if response.status_code == 200:
                    return response.json()
                elif response.status_code == 400:
                    raise APIError(
                        f&quot;Invalid query parameters. Check $expand and $filter syntax. &quot;
                        f&quot;URL: {url}&quot;
                    )
                elif response.status_code == 404:
                    if 'api/' in url and url.count('/') == 4:  # Entity not found
                        raise EntityNotFoundError(f&quot;Entity not found: {url}&quot;)
                    else:  # Invalid ID
                        raise RecordNotFoundError(f&quot;Record not found: {url}&quot;)
                elif response.status_code == 501:
                    raise UnsupportedOperationError(
                        &quot;Write operations are not supported by this API&quot;
                    )
                else:
                    response.raise_for_status()

            except requests.exceptions.Timeout:
                if attempt &lt; self.retry_attempts - 1:
                    wait_time = (2 ** attempt) * 1  # Exponential backoff
                    time.sleep(wait_time)
                    continue
                raise NetworkError(f&quot;Request timed out after {self.timeout} seconds&quot;)

            except requests.exceptions.ConnectionError:
                if attempt &lt; self.retry_attempts - 1:
                    wait_time = (2 ** attempt) * 1
                    time.sleep(wait_time)
                    continue
                raise NetworkError(&quot;Connection error - check your internet connection&quot;)

            except requests.exceptions.RequestException as e:
                raise NetworkError(f&quot;Request failed: {str(e)}&quot;)

    def _build_url(self, entity: str, **params) -&gt; str:
        &quot;&quot;&quot;
        Build properly encoded URL with OData parameters.

        Args:
            entity: Entity name (e.g., 'Sag', 'Akt√∏r')
            **params: OData parameters

        Returns:
            Complete URL with encoded parameters
        &quot;&quot;&quot;
        # Start with base URL and entity
        url = f&quot;{self.base_url}{entity}&quot;

        if not params:
            return url

        # Build query parameters with proper encoding
        query_parts = []
        for key, value in params.items():
            if value is not None:
                # Ensure $ parameters are properly encoded
                if key.startswith('$'):
                    encoded_key = urllib.parse.quote(key, safe='')
                else:
                    encoded_key = key

                encoded_value = urllib.parse.quote(str(value), safe='()\',%')
                query_parts.append(f&quot;{encoded_key}={encoded_value}&quot;)

        return f&quot;{url}?{'&amp;'.join(query_parts)}&quot;

    def get_cases(self, top: int = 100, skip: int = 0, filter_expr: Optional[str] = None, 
                  expand: Optional[str] = None, select: Optional[str] = None,
                  orderby: Optional[str] = None) -&gt; Dict[str, Any]:
        &quot;&quot;&quot;
        Get parliamentary cases (Sag) with optional filtering and expansion.

        Args:
            top: Number of records to return (max 100)
            skip: Number of records to skip for pagination
            filter_expr: OData filter expression
            expand: Related entities to include
            select: Specific fields to return
            orderby: Sort order

        Returns:
            API response with case data

        Example:
            # Get recent climate legislation
            cases = api.get_cases(
                filter_expr=&quot;substringof('klima', titel)&quot;,
                expand=&quot;Sagskategori&quot;,
                top=50
            )
        &quot;&quot;&quot;
        params = {'$top': min(top, 100), '$skip': skip}  # Enforce 100 record limit

        if filter_expr:
            params['$filter'] = filter_expr
        if expand:
            params['$expand'] = expand
        if select:
            params['$select'] = select
        if orderby:
            params['$orderby'] = orderby

        url = self._build_url('Sag', **params)
        return self._make_request(url)

    def get_actors(self, top: int = 100, skip: int = 0, filter_expr: Optional[str] = None,
                   expand: Optional[str] = None) -&gt; Dict[str, Any]:
        &quot;&quot;&quot;
        Get parliamentary actors (Akt√∏r) - politicians, committees, ministries.

        Args:
            top: Number of records to return (max 100)
            skip: Number of records to skip for pagination
            filter_expr: OData filter expression
            expand: Related entities to include

        Returns:
            API response with actor data

        Example:
            # Find all politicians with 'Jensen' in name
            actors = api.get_actors(
                filter_expr=&quot;substringof('Jensen', navn)&quot;
            )
        &quot;&quot;&quot;
        params = {'$top': min(top, 100), '$skip': skip}

        if filter_expr:
            params['$filter'] = filter_expr
        if expand:
            params['$expand'] = expand

        url = self._build_url('Akt√∏r', **params)
        return self._make_request(url)

    def get_voting_records(self, politician_name: str, limit: int = 1000) -&gt; List[Dict[str, Any]]:
        &quot;&quot;&quot;
        Get all voting records for a specific politician.

        Args:
            politician_name: Full name of politician
            limit: Maximum number of votes to return

        Returns:
            List of voting records with expanded details

        Example:
            votes = api.get_voting_records(&quot;Frank Aaen&quot;)
        &quot;&quot;&quot;
        all_votes = []
        skip = 0
        batch_size = 100

        while len(all_votes) &lt; limit and skip &lt; 10000:  # Safety limit
            params = {
                '$expand': 'Afstemning,Akt√∏r',
                '$filter': f&quot;Akt√∏r/navn eq '{politician_name}'&quot;,
                '$top': batch_size,
                '$skip': skip
            }

            url = self._build_url('Stemme', **params)
            response = self._make_request(url)

            votes = response.get('value', [])
            if not votes:
                break

            all_votes.extend(votes)
            skip += batch_size

        return all_votes[:limit]

    def get_recent_changes(self, entity: str = 'Sag', hours_back: int = 24) -&gt; Dict[str, Any]:
        &quot;&quot;&quot;
        Get recent changes to parliamentary data.

        Args:
            entity: Entity to check ('Sag', 'Akt√∏r', 'Afstemning', etc.)
            hours_back: How many hours back to check

        Returns:
            Recent changes in the specified entity

        Example:
            # Check for cases updated in last 4 hours
            recent = api.get_recent_changes('Sag', hours_back=4)
        &quot;&quot;&quot;
        cutoff_time = datetime.now() - timedelta(hours=hours_back)
        iso_time = cutoff_time.strftime('%Y-%m-%dT%H:%M:%S')

        params = {
            '$filter': f&quot;opdateringsdato gt datetime'{iso_time}'&quot;,
            '$orderby': 'opdateringsdato desc',
            '$top': 100
        }

        url = self._build_url(entity, **params)
        return self._make_request(url)

    def get_voting_session_details(self, voting_id: int, expand_votes: bool = True) -&gt; Dict[str, Any]:
        &quot;&quot;&quot;
        Get detailed information about a voting session.

        Args:
            voting_id: ID of the voting session (Afstemning)
            expand_votes: Whether to include individual vote details

        Returns:
            Voting session with optional vote details
        &quot;&quot;&quot;
        expand_parts = ['M√∏de']
        if expand_votes:
            expand_parts.append('Stemme/Akt√∏r')

        params = {
            '$filter': f'id eq {voting_id}',
            '$expand': ','.join(expand_parts)
        }

        url = self._build_url('Afstemning', **params)
        response = self._make_request(url)

        if response.get('value'):
            return response['value'][0]
        else:
            raise RecordNotFoundError(f&quot;Voting session {voting_id} not found&quot;)

    def search_documents(self, search_term: str, include_files: bool = False) -&gt; Dict[str, Any]:
        &quot;&quot;&quot;
        Search parliamentary documents by title.

        Args:
            search_term: Term to search for in document titles
            include_files: Whether to include file download URLs

        Returns:
            Matching documents
        &quot;&quot;&quot;
        params = {
            '$filter': f&quot;substringof('{search_term}', titel)&quot;,
            '$top': 100
        }

        if include_files:
            params['$expand'] = 'Fil'

        url = self._build_url('Dokument', **params)
        return self._make_request(url)

    def get_entity_count(self, entity: str) -&gt; int:
        &quot;&quot;&quot;
        Get total count of records in an entity.

        Args:
            entity: Entity name

        Returns:
            Total number of records
        &quot;&quot;&quot;
        params = {
            '$inlinecount': 'allpages',
            '$top': 1
        }

        url = self._build_url(entity, **params)
        response = self._make_request(url)

        count_str = response.get('odata.count', '0')
        return int(count_str)


# Custom Exception Classes
class APIError(Exception):
    &quot;&quot;&quot;Base exception for API errors.&quot;&quot;&quot;
    pass

class NetworkError(APIError):
    &quot;&quot;&quot;Network-related errors.&quot;&quot;&quot;
    pass

class EntityNotFoundError(APIError):
    &quot;&quot;&quot;Entity does not exist.&quot;&quot;&quot;
    pass

class RecordNotFoundError(APIError):
    &quot;&quot;&quot;Specific record does not exist.&quot;&quot;&quot;
    pass

class UnsupportedOperationError(APIError):
    &quot;&quot;&quot;Operation not supported by API.&quot;&quot;&quot;
    pass


# Usage Examples
if __name__ == &quot;__main__&quot;:
    # Initialize client
    api = DanishParliamentAPI()

    try:
        # Get recent cases
        print(&quot;Getting recent cases...&quot;)
        cases = api.get_cases(top=5)
        print(f&quot;Found {len(cases['value'])} cases&quot;)

        # Search for climate legislation
        print(&quot;\nSearching for climate legislation...&quot;)
        climate_cases = api.get_cases(
            filter_expr=&quot;substringof('klima', titel)&quot;,
            top=10
        )
        print(f&quot;Found {len(climate_cases['value'])} climate-related cases&quot;)

        # Get total case count
        print(&quot;\nGetting total case count...&quot;)
        total_cases = api.get_entity_count('Sag')
        print(f&quot;Total cases in database: {total_cases:,}&quot;)

        # Get recent changes
        print(&quot;\nChecking recent changes...&quot;)
        recent = api.get_recent_changes('Sag', hours_back=24)
        print(f&quot;Cases updated in last 24 hours: {len(recent['value'])}&quot;)

    except APIError as e:
        print(f&quot;API Error: {e}&quot;)
    except NetworkError as e:
        print(f&quot;Network Error: {e}&quot;)
    except Exception as e:
        print(f&quot;Unexpected error: {e}&quot;)
</code></pre>
<h2 id="key-features">Key Features</h2>
<h3 id="error-handling">Error Handling</h3>
<ul>
<li><strong>Comprehensive</strong>: Handles all API error conditions</li>
<li><strong>Informative</strong>: Provides clear error messages with context</li>
<li><strong>Retry Logic</strong>: Automatic retry with exponential backoff</li>
<li><strong>Type-Safe</strong>: Custom exception hierarchy</li>
</ul>
<h3 id="performance">Performance</h3>
<ul>
<li><strong>Rate Limiting</strong>: Built-in request throttling</li>
<li><strong>Efficient Pagination</strong>: Handles large datasets properly</li>
<li><strong>Field Selection</strong>: Supports <code>$select</code> for faster queries</li>
<li><strong>Connection Reuse</strong>: Uses requests session for efficiency</li>
</ul>
<h3 id="production-ready">Production Ready</h3>
<ul>
<li><strong>Logging Ready</strong>: Easy to integrate with Python logging</li>
<li><strong>Configurable</strong>: Timeout and retry settings</li>
<li><strong>Type Hints</strong>: Full type annotations for IDE support</li>
<li><strong>Documentation</strong>: Comprehensive docstrings</li>
</ul>
<h2 id="installation-setup">Installation &amp; Setup</h2>
<p>Save the code as <code>danish_parliament_api.py</code> and use:</p>
<pre><code class="language-python">from danish_parliament_api import DanishParliamentAPI, APIError

# Initialize with custom settings
api = DanishParliamentAPI(timeout=60, retry_attempts=5)

# Use in production with proper error handling
try:
    cases = api.get_cases(top=100)
    # Process cases...
except APIError as e:
    logger.error(f&quot;API error occurred: {e}&quot;)
    # Handle error appropriately
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js"></script>
        <script src="../../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
